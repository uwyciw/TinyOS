# TinyOS

English Readme is [here](README-EN.md).

TinyOS是一款非抢占式、弱优先级、所有任务共用一个栈空间的精简内核。其设计主旨是为那些对实时性、并发性要求不高，但又需要将整体业务逻辑分拆到多个相对独立的任务中，且任务与任务间、任务与外部输入间有基础的事件交互的场景提供一个OS内核。

## 内核介绍
- 任务在OS启动前，需要集中声明；
- 任务声明顺序，隐式指明优先级；
- 每个任务可以绑定32个事件；
- 每个事件只可以被一个任务绑定，绑定后无法解绑和重新绑定，且触发事件前，必须先进行绑定；
- 事件即可以被当作信号量事件使用，通过向其发送信号激活该事件，也可以被当作定时器使用，通过先设置定时数值，并在超时后激活该事件；
- 任务绑定的任一事件处于激活状态，则该任务被激活；
- 内核每次调度，均从优先级最高任务开始，按照优先级逐一查询各任务是否处于激活状态；
- 若任务处于激活状态，则内核会调用该任务的任务函数，因为任务没有自己的栈，所以这仅相当于一次普通的函数调用，函数内的局部变量的生命周期需要特别关注，这与一般的RTOS会有不同；
- 内核在查询到任务绑定的事件中，有处于激活状态后，会使用一个全局变量记录下来，并清除任务自身的记录；
- 任务被执行后，需要任务自己判断其是被哪些事件激活的，并作出对应反馈，内核提供断言接口；

## 目录结构
```
.
├── core
│   ├── inc
│        ├── os.h             # 对外接口头文件
│        └── os_internal.h    # 内部头文件
│   └── src
│        └── os.c             # 内核代码
└── _example                  # 一个例程，在ST的NUCLEO-L053R8运行，可以使用STM32CubeMX产生工程代码
```
